#!/bin/sh
################################################################################
## Home session initialization.
## 2013-03-01
################################################################################
SOURCEDIR="${HOME}/personal/dataperso"
[ -z "$XDG_CONFIG_HOME" ] && XDG_CONFIG_HOME="$HOME/.config"
[ -z "$XDG_DATA_HOME" ] && XDG_DATA_HOME="$HOME/.local/share"
[ -z "$XDG_DATA_DIRS" ] && XDG_DATA_DIRS="/usr/local/share"

## Emacsclient launcher. Required for best emacsclient integration.  For a fully
## functional daemon, you should write a file like this and set 'EDITOR=em'.
if [ ! -f /bin/em ]; then
    echo "==> Emacs (press Ctrl-D to skip)"
    sudo sh -c "echo '#!/bin/sh
emacsclient -a \"\" -t \"\$@\"' > '/bin/em'; chmod 755 /bin/em"
    echo
fi

echo "==> Abook"
ln -snf "$(realpath ${SOURCEDIR}/contacts)" "${HOME}/.abook"
echo

echo "==> Mutt"
ln -snf "$(realpath ${SOURCEDIR}/mails)" "${HOME}/.mutt"
mkdir -p "${HOME}/.mutt.d/hcache"
echo

echo "==> TODO data"
ln -snf "${SOURCEDIR}/todo/todo.org" "${HOME}/todo.org"
echo

echo "==> rtorrent"
mkdir -p "${HOME}/.session"
echo

## Luakit -- Install the adblock modules
if [ -n "$(command -v luakit)" ]; then
    echo "==> Luakit"
    git clone https://github.com/Plaque-fcc/luakit-adblock/ "${HOME}/luakit-adblock"
    cp -fv ~/luakit-adblock/*.lua "$XDG_CONFIG_HOME/luakit"
    rm -rvf "$HOME/luakit-adblock"

    ## Update the adblock lists
    mkdir -p "$XDG_DATA_HOME/luakit/adblock"
    wget https://easylist-downloads.adblockplus.org/easylist.txt \
        https://easylist-downloads.adblockplus.org/easyprivacy.txt \
        https://easylist-downloads.adblockplus.org/easylistgermany.txt \
        http://lian.info.tm/liste_fr.txt \
        -P "$XDG_DATA_HOME/luakit/adblock"
    echo
fi

## dwb -- Install extensions.
if [ -n "$(command -v dwb)" ]; then
    echo "==> dwb"
    dwbem -Ni adblock_subscriptions
    dwbem -Ni youtube_html5
    echo
fi

## Bookmarks
echo "==> Bookmarks"
BROWSER_DATA_DIR="$XDG_DATA_HOME/$BROWSER/"
if [ "$BROWSER" = "dwb" ]; then
    BROWSER_DATA_DIR="$XDG_CONFIG_HOME/$BROWSER/default/"
fi
ln -sf "${SOURCEDIR}/bookmarks/bookmarks" "$BROWSER_DATA_DIR"
ln -sf "${SOURCEDIR}/bookmarks/quickmarks" "$BROWSER_DATA_DIR"
echo

## News
echo "==> Newsbeuter"
mkdir -p "$XDG_DATA_HOME/newsbeuter"
ln -sf "${SOURCEDIR}/news/urls" "$XDG_CONFIG_HOME/newsbeuter/"
ln -sf "${SOURCEDIR}/news/news_starred" "$XDG_CONFIG_HOME/newsbeuter/"
echo
