## -*- mode:sh -*- #
################################################################################
## Mutt Configuration
## Date 2013-03-02
################################################################################

## Note on folders:
## These folders are assumed to exist:
## ~/.mutt: personal stuff (contacts, account information)
## ~/.mutt.d: public stuff (theme, mailcap)

##------------------------------------------------------------------------------
## General options
##------------------------------------------------------------------------------

## Beep on new incoming mails.
set beep_new = "yes"

## Headers are editable in editor.
set edit_headers=yes

## Set EDITOR dynamically.
source "~/.mutt.d/maileditor.sh|"

## Store message headers locally to speed things up. Gentoo wiki says that if a
## folder is specified, it is even faster. If no folder exists, the cache will
## be a single file.
set header_cache = "~/.cache/mutt"

## Tell Mutt to check all IMAP folders. This will add all of them to the
## sidebar. Contrary to the manu 'mailboxes' way, order cannot be controlled, so
## you should set 'sidebar_sort' to yes. This will sort the folders
## alphabetically, ignoring punctuation.
set imap_check_subscribed

## Keep imap connection alive by polling intermittently (time in seconds).
set imap_keepalive = 300

## Allow mutt to open new imap connection automatically.
unset imap_passive

## Mailcap
set mailcap_path = ~/.mutt.d/mailcap
auto_view text/html
alternative_order text/plain text/html

## How often to check for new mail (time in seconds).
set mail_check = 60

## Mailbox type.
set mbox_type=Maildir

## Encoding
set send_charset="us-ascii:utf-8"

## Remove delay between mailbox switches.
set sleep_time = 0

##------------------------------------------------------------------------------
## Multiple accounts
##------------------------------------------------------------------------------

set my_ac_dev=dev
set my_ac_personal=personal
set my_ac_university=university
set my_ac_work=work

## Login
## Store passwords as follows in .mutt-pwds:
##   set my_pw_account = foo
##
## CCRYPT:
##  ccencrypt .mutt-pwds
##
## GNUPG: Generate a key pair with:
##   gpg2 --gen-key
## Encrypt them with:
##   gpg2 -e -r <user> ".mutt-pwds"
source "ccat ~/.mutt-pwds.cpt |"
# source "gpg2 -dq ~/.mutt-pwds.gpg |"

## Last account is default.
source "~/.mutt/$my_ac_dev"
folder-hook $folder 'source ~/.mutt/$my_ac_dev'
source "~/.mutt/$my_ac_personal"
folder-hook $folder 'source ~/.mutt/$my_ac_personal'
source "~/.mutt/$my_ac_university"
folder-hook $folder 'source ~/.mutt/$my_ac_university'
source "~/.mutt/$my_ac_work"
folder-hook $folder 'source ~/.mutt/$my_ac_work'

macro index,pager <f2> '<enter-command>source ~/.mutt/$my_ac_dev<enter><change-folder>!<enter>'
macro index,pager <f3> '<enter-command>source ~/.mutt/$my_ac_personal<enter><change-folder>!<enter>'
macro index,pager <f4> '<enter-command>source ~/.mutt/$my_ac_university<enter><change-folder>!<enter>'
macro index,pager <f5> '<enter-command>source ~/.mutt/$my_ac_work<enter><change-folder>!<enter>'

##------------------------------------------------------------------------------
## Sidebar
##------------------------------------------------------------------------------

set sidebar_visible = yes
set sidebar_width = 24
set sidebar_shortpath = yes
set sidebar_sort = yes
set sidebar_delim=' '
# set sidebar_format = "%B%?F? [%F]?%* %?N?%N/?%4S"
# set sidebar_folderindent = yes

## Color of folders with new mail
color sidebar_new yellow default

## Ctrl-n, Ctrl-p to select next, previous folder.
## Ctrl-o to open selected folder
bind index,pager \CP sidebar-prev
bind index,pager \CN sidebar-next
bind index,pager \CO sidebar-open

## Toggle sidebar visibility
# macro index b '<enter-command>toggle sidebar_visible<enter>'
# macro pager b '<enter-command>toggle sidebar_visible<enter>'
## Prevent messy output
macro index b '<enter-command>toggle sidebar_visible<enter><refresh>'
macro pager b '<enter-command>toggle sidebar_visible<enter><redraw-screen>'

##------------------------------------------------------------------------------
## Aliases
##------------------------------------------------------------------------------

## Mutt native support
# set alias_file = "~/.mutt/aliases"
# set sort_alias = alias
# set reverse_alias = yes
# source $alias_file

## Abook
## We redirect the error stream in case the config file in not compatible with
## current abook bersion.
set query_command= "abook --mutt-query '%s' 2>/dev/null"
macro index,pager  a "<pipe-message>abook --add-email-quiet<return>" "Add this sender to Abook"
bind editor        <Tab> complete-query

##------------------------------------------------------------------------------
## Keys
##------------------------------------------------------------------------------

## Security issue: if enter-command is available from the GUI, it is possible to
## see the password unencrypted. We disable it for this reason. Every command
## that the user intends to use must be bound to a key in advance, otherwise it
## will never be accessible.
bind index,pager ':' noop

## Remap bounce-message function to "B"
bind index B bounce-message

## Fix the 'change-dir' issue with multiple accounts. When change-dir was called
## with account A, then use switched to account B, change-dir will still point
## to account A by default.
# macro index 'c' '<change-folder>?<change-dir><home>^K=<enter>'

## Manual fetch.
bind index "^" imap-fetch-mail

## Fix the backspace wrong binding that happens on some terminals.
#bind index,pager  previous-page

## Fix Backspace -- Shell alternative.
##   $ infocmp > termbs.src
## Changed kbs=^H to kbs=\177, then:
##   $ tic -x termbs.src

##------------------------------------------------------------------------------
## Custom headers for outgoing mail
##------------------------------------------------------------------------------

## Undo any custom headers that may have been put in by the global Muttrc
# unmy_hdr *

## Remove any global 'From:' header
# unset use_from
## Don't append a domain to my outgoing mails
# unset use_domain
# my_hdr From: Firstname Lastname <myfirstname@mymailserver>

## Extra info.
my_hdr X-Info: Simplicity is the ultimate sophistication.

## OS Info.
# my_hdr X-Operating-System: `uname -s`, kernel `uname -r`

## This header only appears to MS Outlook users
# my_hdr X-Message-Flag: WARNING!! Outlook sucks!

## Custom Mail-User-Agent ID.
set user_agent = yes
# my_hdr User-Agent: Every email client sucks, this one just sucks less.

##------------------------------------------------------------------------------
## Themes
##------------------------------------------------------------------------------

## TODO: Use these variables to get dynamic column size.
# set my_col_from = `echo $((30 * ($COLUMNS-34) / 100))`
# set my_col_subject = `echo $((70 * ($COLUMNS-34) / 100))`

## Index format
## See 'man 3 strftime' and 'man 3 printf'.
# set index_format="%?M?_%M_ ?%Z %2C %.13d (%-68.68F) %-68.68s %?M?_%M_&(%c/%l?"
set date_format="%y-%m-%d %T"
folder-hook .*[sS]ent.* 'set index_format="%2C | %Z [%d] %-30.30t (%-4.4c) %s"'
folder-hook ! .*[sS]ent.* 'set index_format="%2C | %Z [%d] %-30.30F (%-4.4c) %s"'

## Colors
source "~/.mutt.d/colorset.sh|"
source "~/.mutt.d/colors.ambrevar"
# source "/usr/share/doc/mutt/samples/colors.default"
# source "/usr/share/doc/mutt/samples/colors.linux"

